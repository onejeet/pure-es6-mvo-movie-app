var model={api_url:"http://www.mocky.io/v2/5d336c403400005a00749ff9",data:[],state:{currentList:[],search:"",darkTheme:!1,sortType:"asc",sortValue:""},main:document.querySelector(".app main"),moviesContainer:document.querySelector(".list-all"),libraryContainer:document.querySelector(".my-library"),searchInput:document.getElementById("search-movie"),sortingContainer:document.getElementById("sort"),themeContainer:document.getElementById("theme")},view={init:function(){this.toggleCurrentPageState(octopus.findContainer("moviesContainer"))},toggleCurrentPageState:function(t){t.setAttribute("data-state","active"),t.nextElementSibling?t.nextElementSibling.setAttribute("data-state","inactive"):t.previousElementSibling.setAttribute("data-state","inactive")},toggleButtonState:function(t,e){e?(t.querySelector(".add-button").textContent="Added",setTimeout(function(){t.querySelector(".add-button").textContent="Remove",t.querySelector(".add-button").className+=" remove"},300)):(t.querySelector(".add-button").textContent="Removed",setTimeout(function(){t.querySelector(".add-button").textContent="Add",t.querySelector(".add-button").className="add-button"},300))},displaySearchClear:function(t){var e=octopus.findContainer("searchInput");t&&""!==e.value?e.nextElementSibling.style.opacity=1:e.nextElementSibling.style.opacity=0},clearSearch:function(){octopus.findContainer("searchInput").value=""},cardBuilder:function(t){var e=document.createElement("div");e.setAttribute("class","card"),e.setAttribute("id",t.id);var n=t.library?"remove":"",r=t.library?"Remove":"Add";return e.innerHTML='<div class="thumb"><img src='+t.poster+'/><button class="add-button '+n+'">'+r+'</button></div><div class="info"><p>'+t.title+"</p><p>"+t.year+"</p></div>",e},renderSortingDirector:function(){var t=document.createElement("button");t.setAttribute("class","sorting-director"),t.setAttribute("title","Toggle the Order"),t.innerHTML="&varr;",octopus.findContainer("sortingContainer").parentNode.prepend(t)},renderTheme:function(t){var e=octopus.findContainer("themeContainer");t?(e.setAttribute("title","Turn On Light Mode"),document.querySelector("body").className="dark"):(e.setAttribute("title","Turn On Dark Mode"),document.querySelector("body").className="")},render:function(){var e=this,n=document.createElement("div"),t=octopus.findContainer("main");n.setAttribute("id","movies-list");var r=octopus.sort();(r=octopus.search(r)).length&&0<r.length?r.map(function(t){el=e.cardBuilder(t),octopus.bindAddEvents(el,t),n.appendChild(el)}):n.innerHTML="No Movies Found!",t.innerHTML="",t.appendChild(n)}},octopus={init:function(){this.fetchData(),this.bindEvents(),this.store=this.createStore()},createStore:function(){return new Proxy(model.state,this.handleStateChange)},handleStateChange:{set:function(t,e,n){t[e]=n,"darkTheme"===e?view.renderTheme(n):view.render()},get:function(t,e){return t[e]}},bindEvents:function(){this.findContainer("libraryContainer").addEventListener("click",function(t){view.toggleCurrentPageState(t.target),octopus.store.currentList=model.data.filter(function(t){return t.library})}),this.findContainer("moviesContainer").addEventListener("click",function(t){view.toggleCurrentPageState(t.target),octopus.store.currentList=model.data.filter(function(t){return!t.library})}),this.findContainer("searchInput").addEventListener("input",function(t){view.displaySearchClear(!0),octopus.store.search=t.target.value}),this.findContainer("searchInput").nextElementSibling.addEventListener("click",function(t){octopus.clearSearch()}),this.findContainer("sortingContainer").addEventListener("change",function(t){"none"!==t.target.value&&octopus.store.sortValue!==t.target.value&&(octopus.store.sortValue=t.target.value,this.previousElementSibling||(view.renderSortingDirector(),this.previousElementSibling.addEventListener("click",function(){octopus.store.sortType="asc"===octopus.store.sortType?"dsc":"asc"})))}),this.findContainer("themeContainer").addEventListener("click",function(){octopus.toggleTheme()})},bindAddEvents:function(e,n){e.querySelector(".add-button").addEventListener("click",function(t){n.library?(view.toggleButtonState(e,!1),octopus.removeFromLibrary(n)):(octopus.addToLibrary(n),view.toggleButtonState(e,!0))})},toggleTheme:function(){octopus.store.darkTheme=!octopus.store.darkTheme},clearSearch:function(){octopus.store.search="",view.clearSearch(),view.displaySearchClear(!1)},findContainer:function(t){return model[t]},getCurrentList:function(){return octopus.store.currentList},removeFromLibrary:function(t){t.library=!1,"active"===this.findContainer("libraryContainer").getAttribute("data-state")&&(octopus.store.currentList=octopus.store.currentList.filter(function(t){return t.library}))},addToLibrary:function(t){t.library=!0},search:function(t){var e=octopus.store.search;return t.filter(function(t){return-1!==t.title.toLowerCase().indexOf(e.toLowerCase())})},sort:function(){var n=octopus.store.sortValue,t=octopus.store.currentList;return"year"===n?t.sort(function(t,e){return"asc"===octopus.store.sortType?e[n]-t[n]:t[n]-e[n]}):"title"===n?t.sort(function(t,e){return"asc"===octopus.store.sortType?t[n].localeCompare(e[n]):e[n].localeCompare(t[n])}):t},fetchData:function(){var e=this;fetch(model.api_url).then(function(t){return t.json()}).then(function(t){model.data=t,e.store.currentList=t,view.init()}).catch(function(t){return console.log("Error: "+t)})}};octopus.init();