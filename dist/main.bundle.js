var model={api_url:"http://www.mocky.io/v2/5d336c403400005a00749ff9",data:[],currentList:[],search:"",darkTheme:!1,sorting:{value:"",type:"asc"},main:document.querySelector(".app main"),moviesContainer:document.querySelector(".list-all"),libraryContainer:document.querySelector(".my-library"),searchInput:document.getElementById("search-movie"),sortingContainer:document.getElementById("sort").parentNode,themeContainer:document.getElementById("theme")},view={init:function(){this.toggleCurrentPageState(octopus.findContainer("moviesContainer")),this.render()},toggleCurrentPageState:function(e){e.setAttribute("data-state","active"),e.nextElementSibling?e.nextElementSibling.setAttribute("data-state","inactive"):e.previousElementSibling.setAttribute("data-state","inactive")},toggleButtonState:function(e,t){t?(e.querySelector(".add-button").textContent="Added",setTimeout(function(){e.querySelector(".add-button").textContent="Remove",e.querySelector(".add-button").className+=" remove"},300)):(e.querySelector(".add-button").textContent="Removed",setTimeout(function(){e.querySelector(".add-button").textContent="Add",e.querySelector(".add-button").className="add-button"},300))},displaySearchClear:function(e){var t=octopus.findContainer("searchInput");e&&""!==t.value?t.nextElementSibling.style.opacity=1:t.nextElementSibling.style.opacity=0},clearSearch:function(){octopus.findContainer("searchInput").value=""},cardBuilder:function(e){var t=document.createElement("div");t.setAttribute("class","card"),t.setAttribute("id",e.id);var n=e.library?"remove":"",r=e.library?"Remove":"Add";return t.innerHTML='<div class="thumb"><img src='+e.poster+'/><button class="add-button '+n+'">'+r+'</button></div><div class="info"><p>'+e.title+"</p><p>"+e.year+"</p></div>",t},renderSortingDirector:function(){var e=document.createElement("button");e.setAttribute("class","sorting-director"),e.setAttribute("title","Toggle the Order"),e.innerHTML="&varr;",octopus.findContainer("sortingContainer").prepend(e)},renderTheme:function(e){var t=octopus.findContainer("themeContainer");t.className=e?"dark":" "},render:function(){var t=this,n=document.createElement("div"),e=octopus.findContainer("main");n.setAttribute("id","movies-list"),octopus.sort();var r=octopus.search(octopus.getCurrentList());r.length&&0<r.length?r.map(function(e){el=t.cardBuilder(e),octopus.bindAddEvents(el,e),n.appendChild(el)}):n.innerHTML="No Movies Found!",e.innerHTML="",e.appendChild(n)}},octopus={init:function(){this.fetchData(),this.bindEvents()},bindEvents:function(){this.findContainer("libraryContainer").addEventListener("click",function(e){model.currentList=model.data.filter(function(e){return e.library}),view.toggleCurrentPageState(e.target),view.render()}),this.findContainer("moviesContainer").addEventListener("click",function(e){model.currentList=model.data.filter(function(e){return!e.library}),view.toggleCurrentPageState(e.target),view.render()}),this.findContainer("searchInput").addEventListener("input",function(e){view.displaySearchClear(!0),model.search=e.target.value,view.render()}),this.findContainer("searchInput").nextElementSibling.addEventListener("click",function(e){octopus.clearSearch(),view.render()}),this.findContainer("sortingContainer").addEventListener("click",function(e){"sorting-director"===e.target.className?(model.sorting.type="asc"===model.sorting.type?"dsc":"asc",view.render()):"none"!==e.target.value&&model.sorting.value!==e.target.value&&(model.sorting.value=e.target.value,view.render(),this.querySelector("button.sorting-director")||view.renderSortingDirector())}),this.findContainer("themeContainer").addEventListener("click",function(){octopus.toggleTheme(this.className)})},bindAddEvents:function(t,n){t.querySelector(".add-button").addEventListener("click",function(e){n.library?(view.toggleButtonState(t,!1),octopus.removeFromLibrary(n)):(octopus.addToLibrary(n),view.toggleButtonState(t,!0))})},toggleTheme:function(){model.darkTheme=!model.darkTheme,view.renderTheme(model.darkTheme)},clearSearch:function(){model.search="",view.clearSearch(),view.displaySearchClear(!1)},findContainer:function(e){return model[e]},getCurrentList:function(){return model.currentList},removeFromLibrary:function(e){e.library=!1,"active"===this.findContainer("libraryContainer").getAttribute("data-state")&&(model.currentList=model.currentList.filter(function(e){return e.library}),view.render())},addToLibrary:function(e){e.library=!0},search:function(e){var t=model.search;return e.filter(function(e){return-1!==e.title.toLowerCase().indexOf(t.toLowerCase())})},sort:function(){var e,n=model.sorting.value,t=model.currentList;e="year"===n?t.sort(function(e,t){return"asc"===model.sorting.type?t[n]-e[n]:e[n]-t[n]}):"title"===n?t.sort(function(e,t){return"asc"===model.sorting.type?e[n].localeCompare(t[n]):t[n].localeCompare(e[n])}):t,model.currentList=e},fetchData:function(){fetch(model.api_url).then(function(e){return e.json()}).then(function(e){model.data=e,model.currentList=e,view.init()}).catch(function(e){return console.log("Error: "+e)})}};octopus.init();