var model={api_url:"http://www.mocky.io/v2/5d321d223300006b007ba592",data:[],library:[],currentList:""},view={init:function(){},cardBuilder:function(t){var e=document.createElement("div");e.setAttribute("class","card"),e.setAttribute("id",t.id);var n=t.library?"remove":"",r=t.library?"Remove":"Add";return e.innerHTML='<div class="thumb"><img src='+t.poster+'/><button class="add-button '+n+'">'+r+'</button></div><div class="info"><p>'+t.title+"</p><p>"+t.year+"</p></div>",e},render:function(t){var e=this,n=document.querySelector(".app main"),r=document.createElement("div");r.setAttribute("id","movie-list"),0<t.length?t.map(function(t){el=e.cardBuilder(t),octopus.bindAddEvents(el,t),r.appendChild(el)}):r.innerHTML="Library has no movies. Start Adding!",n.innerHTML="",n.appendChild(r)}},octopus={init:function(){this.fetchData(),this.bindEvents()},bindEvents:function(){document.querySelector(".my-library").addEventListener("click",function(){view.render(model.library),model.currentList="library"}),document.querySelector(".add-movies").addEventListener("click",function(){view.render(model.data),model.currentList="data"}),document.getElementById("search-movie").addEventListener("input",function(t){octopus.search(this.value)}),document.getElementById("sort").addEventListener("change",function(t){octopus.sort(this.value)})},bindAddEvents:function(e,n){e.addEventListener("click",function(t){n.library?octopus.removeFromLibrary(e,n):octopus.addToLibrary(e,n)})},updateData:function(t){model.data=t,view.render(t),model.currentList="data"},removeFromLibrary:function(t,e){model.library.some(function(t,e){return t.id==t.id&&(model.library.splice(e,1),!0)}),t.querySelector(".add-button").textContent="Removed",setTimeout(function(){t.querySelector(".add-button").textContent="Add",t.querySelector(".add-button").className="add-button"},400),"library"===model.currentList&&view.render(model.library),this.toggleButtonState(e,!1)},addToLibrary:function(t,e){model.library.push(e),t.querySelector(".add-button").textContent="Added",setTimeout(function(){t.querySelector(".add-button").textContent="Remove",t.querySelector(".add-button").className+=" remove"},400),this.toggleButtonState(e,!0)},search:function(e){console.log(e);var t=model[model.currentList].filter(function(t){return-1!==t.title.toLowerCase().indexOf(e.toLowerCase())});view.render(t)},sort:function(n){var t;console.log(n),t="year"===n?model[model.currentList].sort(function(t,e){return e[n]-t[n]}):model[model.currentList].sort(function(t,e){return t[n].localeCompare(e[n])}),console.log(t),view.render(t)},toggleButtonState:function(t,e){t.library=!!e},fetchData:function(){fetch(model.api_url).then(function(t){return t.json()}).then(function(t){octopus.updateData(t)}).catch(function(t){return console.log("Error: "+t)})}};octopus.init();